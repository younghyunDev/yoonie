<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ½ï¸ ìœ¤ì´ ë­ë­ ë¨¹ì§€?</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom right, #fff9f0, #ffe0e0);
      color: #333;
      padding: 1rem;
      margin: 0;
    }
    .header-container {
      text-align: center;
      margin-bottom: 2rem;
    }
    h1 {
      font-size: 2.5rem;
      line-height: 1.2;
      margin: 0 0 1rem 0;
    }
    .tree {
      display: block; max-width: 800px; margin: 0 auto; padding: 1rem;
      background: #fff; border-radius: 1rem; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      position: relative;
    }
    .node {
      position: relative; padding-left: 1rem; margin-bottom: 1rem;
      transition: background-color 0.3s ease, opacity 0.5s ease;
      display: flex; justify-content: space-between; align-items: center;
    }
    .node-content { display: flex; align-items: center; gap: 0.5rem; }
    .node-text::before {
      content: ''; /* Removed emoji */
      position: absolute; left: 0; top: 50%;
      transform: translateY(-50%);
    }
    .parent-node > .node-content { cursor: pointer; }
    .toggle-icon {
      display: inline-block; width: 1em; transition: transform 0.2s ease-in-out;
      padding-right: 5px;
    }
    .parent-node.expanded > .node-content .toggle-icon { transform: rotate(90deg); }
    .branch {
      margin-left: 1.5rem; border-left: 2px dashed #ccc; padding-left: 1rem;
      display: none;
    }
    .branch.visible { display: block; }
    .choice-node { cursor: pointer; border-radius: 8px; }
    .choice-node:hover { background-color: #fdf5e6; }
    .selected { background-color: #e0f7fa; font-weight: bold; }
    .unselected { opacity: 0.4; pointer-events: none; }
    .removed .node-text { text-decoration: line-through; color: #aaa; }
    .removed { opacity: 0.6; }
    .button-container { text-align: center; margin: 1.5rem 0; }
    .action-button {
      margin: 0.25rem 0.5rem; padding: 0.75rem 1.5rem; font-size: 1rem;
      color: white; border: none; border-radius: 1rem; cursor: pointer;
      transition: all 0.3s ease;
    }
    .action-button.start { background-color: #ff9a9e; }
    .action-button.start:hover { background-color: #ff6a6a; transform: scale(1.05); }
    .action-button.reset { background-color: #a0aec0; }
    .action-button.reset:hover { background-color: #718096; transform: scale(1.05); }
    .action-button.search { background-color: #f7e600; color: #3d1e1f; font-weight: bold;}
    .action-button.search:hover { background-color: #e8d700; transform: scale(1.05); }
    .action-button.edit { background-color: #f6ad55; }
    .action-button.edit:hover { background-color: #ed8936; transform: scale(1.05); }
    .result {
      text-align: center; margin-top: 1.5rem; font-size: 1.5rem;
      font-weight: bold; color: #d6336c; min-height: 2rem;
    }
    .highlight { background-color: #fff3cd; border-radius: 4px; }
    .hidden { display: none; }
    .remove-btn {
      background-color: #fed7d7; color: #c53030; border: none; border-radius: 50%;
      width: 22px; height: 22px; font-size: 14px; font-weight: bold;
      line-height: 22px; text-align: center; cursor: pointer; margin-left: 10px;
      flex-shrink: 0; transition: all 0.2s; display: none;
    }
    .edit-mode .remove-btn { display: block; }
    .remove-btn:hover { background-color: #fbb6b6; }
    .node.removed .remove-btn { background-color: #c8e6c9; color: #2e7d32; }
    .loading-spinner {
        border: 4px solid #f3f3f3; border-top: 4px solid #3d1e1f;
        border-radius: 50%; width: 20px; height: 20px;
        animation: spin 1s linear infinite; display: inline-block;
        margin-left: 10px; vertical-align: middle;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    @media (max-width: 600px) {
      h1 { font-size: 2rem; }
      .node { font-size: 0.95rem; }
      .result { font-size: 1.3rem; }
    }
  </style>
</head>
<body class="">
  <div class="header-container">
    <h1>ğŸ¥¢ ìœ¤ì´ ë­ë­ ë¨¹ì§€?</h1>
  </div>
  
  <div class="tree" id="tree">
    <!-- Tree HTML structure remains the same -->
    <div class="node" id="root-node">
        <div class="node-content"><span class="node-text">â“ ìˆ ì„ ë¨¹ì„ ê²ƒì¸ê°€?</span></div>
    </div>
      <div class="branch visible">
        <div class="node choice-node" id="choice-yes">
          <div class="node-content"><span class="node-text">ğŸ¶ <strong>Yes!</strong> ìˆ ì„ ë¨¹ëŠ”ë‹¤</span></div>
        </div>
          <div class="branch">
            <div class="node parent-node"><div class="node-content"><span class="node-text">ğŸ¶ ì†Œì£¼</span></div></div>
              <div class="branch">
                <div class="node"><div class="node-content"><span class="node-text">ì‚¼ê²¹ì‚´</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">ê°ìíƒ•</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">íšŒ</span></div></div>
              </div>
            <div class="node parent-node"><div class="node-content"><span class="node-text">ğŸº ë§¥ì£¼</span></div></div>
              <div class="branch">
                <div class="node"><div class="node-content"><span class="node-text">ì¹˜í‚¨</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">í”¼ì</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">ê°ë°”ìŠ¤</span></div></div>
              </div>
            <div class="node parent-node"><div class="node-content"><span class="node-text">ğŸ· ì™€ì¸</span></div></div>
              <div class="branch">
                <div class="node"><div class="node-content"><span class="node-text">ì¹˜ì¦ˆ</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">íŒŒìŠ¤íƒ€</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">ìŠ¤í…Œì´í¬</span></div></div>
              </div>
             <div class="node parent-node"><div class="node-content"><span class="node-text">ğŸ¶ ë§‰ê±¸ë¦¬</span></div></div>
              <div class="branch">
                <div class="node"><div class="node-content"><span class="node-text">íŒŒì „</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">ë„í† ë¦¬ë¬µ</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">ì „ê³¨</span></div></div>
              </div>
             <div class="node parent-node"><div class="node-content"><span class="node-text">ğŸ¹ ì¹µí…Œì¼</span></div></div>
              <div class="branch">
                <div class="node"><div class="node-content"><span class="node-text">ë‚˜ìµ¸</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">íƒ€íŒŒìŠ¤</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">í•´ì‚°ë¬¼</span></div></div>
              </div>
            <div class="node parent-node"><div class="node-content"><span class="node-text">ğŸ¶ ê³ ëŸ‰ì£¼</span></div></div>
              <div class="branch">
                <div class="node"><div class="node-content"><span class="node-text">í› ê¶ˆ</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">ì–‘ê¼¬ì¹˜</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">ë§ˆë¼ìƒ¹ê¶ˆ</span></div></div>
              </div>
          </div>
        <div class="node choice-node" id="choice-no">
          <div class="node-content"><span class="node-text">ğŸš« <strong>No!</strong> ìˆ  ì•ˆ ë¨¹ëŠ”ë‹¤</span></div>
        </div>
          <div class="branch">
            <div class="node parent-node"><div class="node-content"><span class="node-text">ğŸš í•œì‹</span></div></div>
              <div class="branch">
                <div class="node"><div class="node-content"><span class="node-text">êµ­ë°¥</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">ì œìœ¡ë³¶ìŒ</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">ë¹„ë¹”ë°¥</span></div></div>
              </div>
            <div class="node parent-node"><div class="node-content"><span class="node-text">ğŸ¥¡ ì¤‘ì‹</span></div></div>
              <div class="branch">
                <div class="node"><div class="node-content"><span class="node-text">ì§œì¥ë©´</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">íƒ•ìˆ˜ìœ¡</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">ë§ˆë¼íƒ•</span></div></div>
              </div>
            <div class="node parent-node"><div class="node-content"><span class="node-text">ğŸ£ ì¼ì‹</span></div></div>
              <div class="branch">
                <div class="node"><div class="node-content"><span class="node-text">ëˆì¹´ì¸ </span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">ì´ˆë°¥</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">ìš°ë™</span></div></div>
              </div>
            <div class="node parent-node"><div class="node-content"><span class="node-text">ğŸ ì–‘ì‹</span></div></div>
              <div class="branch">
                <div class="node"><div class="node-content"><span class="node-text">íŒŒìŠ¤íƒ€</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">ë¦¬ì¡°ë˜</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">ìŠ¤í…Œì´í¬</span></div></div>
              </div>
            <div class="node parent-node"><div class="node-content"><span class="node-text">ğŸ¢ ë¶„ì‹</span></div></div>
              <div class="branch">
                <div class="node"><div class="node-content"><span class="node-text">ë–¡ë³¶ì´</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">ìˆœëŒ€</span></div></div>
                <div class="node"><div class="node-content"><span class="node-text">ê¹€ë°¥</span></div></div>
              </div>
          </div>
      </div>
  </div>

  <div class="button-container hidden" id="button-container">
      <button class="action-button edit" id="edit-button">âœï¸ í¸ì§‘</button>
      <button class="action-button start" id="start-selection-button">âœ¨ ë©”ë‰´ ê²°ì • ì‹œì‘!</button>
      <button class="action-button reset" id="reset-button">ğŸ”„ ì´ˆê¸°í™”</button>
      <button class="action-button search hidden" id="kakaomap-button">ğŸ“ ë‚´ ì£¼ë³€ ë§›ì§‘ ê²€ìƒ‰</button>
  </div>
  <div class="result" id="result"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const body = document.body;
        const editButton = document.getElementById('edit-button');
        const startButton = document.getElementById('start-selection-button');
        const resetButton = document.getElementById('reset-button');
        const kakaoMapButton = document.getElementById('kakaomap-button');
        const buttonContainer = document.getElementById('button-container');
        const resultDiv = document.getElementById('result');
        
        let selectionStartNode = null;
        let isEditMode = false;

        function setupNodes() {
            document.querySelectorAll('.node').forEach(node => {
                const nextBranch = findNextSibling(node, '.branch');
                if (nextBranch) {
                    node.classList.add('parent-node');
                    const nodeContent = node.querySelector('.node-content');
                    if (!nodeContent.querySelector('.toggle-icon')) {
                        const toggleIcon = document.createElement('span');
                        toggleIcon.className = 'toggle-icon';
                        toggleIcon.textContent = 'â–¶';
                        nodeContent.insertBefore(toggleIcon, nodeContent.firstChild);
                        nodeContent.addEventListener('click', () => {
                            if (node.classList.contains('choice-node') && !isEditMode) return;
                            toggleNode(node);
                        });
                    }
                }

                if (!node.classList.contains('choice-node') && node.id !== 'root-node') {
                     if (!node.querySelector('.remove-btn')) {
                        const removeBtn = document.createElement('button');
                        removeBtn.className = 'remove-btn';
                        removeBtn.innerHTML = '&times;';
                        node.appendChild(removeBtn);
                        removeBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            node.classList.toggle('removed');
                            removeBtn.innerHTML = node.classList.contains('removed') ? '&#43;' : '&times;';
                        });
                    }
                }
            });
        }

        function toggleNode(node, forceExpand = false) {
            const nextBranch = findNextSibling(node, '.branch');
            if (!nextBranch) return;

            const isExpanded = node.classList.contains('expanded');
            if (forceExpand && isExpanded) return;
            
            node.classList.toggle('expanded', forceExpand || !isExpanded);
            nextBranch.classList.toggle('visible', forceExpand || !isExpanded);
            const icon = node.querySelector('.toggle-icon');
            if(icon) {
                 icon.style.transform = (forceExpand || !isExpanded) ? 'rotate(90deg)' : 'rotate(0deg)';
            }
        }

        function makeChoice(selectedNode, unselectedNode) {
            selectedNode.classList.add('selected');
            unselectedNode.classList.add('unselected');
            document.getElementById('choice-yes').style.pointerEvents = 'none';
            document.getElementById('choice-no').style.pointerEvents = 'none';
            toggleNode(selectedNode, true);
            selectionStartNode = selectedNode;
            buttonContainer.classList.remove('hidden');
            const choiceText = selectedNode.id === 'choice-yes' ? 'ìˆ ê³¼ ì•ˆì£¼' : 'ë©”ë‰´';
            startButton.textContent = `âœ¨ ì˜¤ëŠ˜ì˜ ${choiceText} ê²°ì •!`;
        }
        
        document.getElementById('choice-yes').addEventListener('click', () => makeChoice(document.getElementById('choice-yes'), document.getElementById('choice-no')));
        document.getElementById('choice-no').addEventListener('click', () => makeChoice(document.getElementById('choice-no'), document.getElementById('choice-yes')));
        
        editButton.addEventListener('click', () => {
            isEditMode = !isEditMode;
            body.classList.toggle('edit-mode');
            editButton.innerHTML = isEditMode ? 'âœ… ì™„ë£Œ' : 'âœï¸ í¸ì§‘';
        });

        startButton.addEventListener('click', () => {
            if (!selectionStartNode) return;
            resetUIState();
            buttonContainer.classList.add('hidden');
            simulateStepByStep(selectionStartNode);
        });

        resetButton.addEventListener('click', () => {
            location.reload();
        });

        kakaoMapButton.addEventListener('click', () => {
            const foodName = kakaoMapButton.dataset.food;
            if (!foodName) return;

            resultDiv.innerHTML = 'ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ëŠ” ì¤‘... <div class="loading-spinner"></div>';

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;
                    const query = encodeURIComponent(foodName.split(' ')[0]);
                    
                    const url = `https://map.kakao.com/link/search/${query}`;
                    
                    window.open(url, '_blank');
                    resultDiv.textContent = `âœ… '${foodName}' ì£¼ë³€ ë§›ì§‘ì„ ì¹´ì¹´ì˜¤ë§µì—ì„œ í™•ì¸í•˜ì„¸ìš”!`;
                },
                () => {
                    resultDiv.textContent = 'ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ì–´, ê¸°ë³¸ ê²€ìƒ‰ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.';
                    const query = encodeURIComponent(foodName.split(' ')[0]);
                    const url = `https://map.kakao.com/link/search/${query}`;
                    window.open(url, '_blank');
                }
            );
        });

        function resetUIState() {
             document.querySelectorAll('.highlight').forEach(n => n.classList.remove('highlight'));
             resultDiv.innerHTML = '';
             buttonContainer.classList.add('hidden');
             kakaoMapButton.classList.add('hidden');
        }

        function findNextSibling(element, selector) {
            let sibling = element.nextElementSibling;
            while(sibling) {
                if (sibling.matches(selector)) return sibling;
                sibling = sibling.nextElementSibling;
            }
            return null;
        }

        function ensurePathVisible(node) {
            let current = node.parentElement;
            while (current && current.id !== 'tree') {
                if (current.classList.contains('branch')) {
                    const parentNode = current.previousElementSibling;
                    if (parentNode) toggleNode(parentNode, true);
                }
                current = current.parentElement;
            }
        }
        
        function simulateStepByStep(startNode) {
            let current = startNode;
            const path = [current];

            while (true) {
                const branch = findNextSibling(current, '.branch');
                if (!branch) break;
                
                const availableChildren = Array.from(branch.querySelectorAll(':scope > .node')).filter(c => !c.classList.contains('removed'));

                if (availableChildren.length === 0) {
                    resultDiv.textContent = `ğŸ¤” '${current.querySelector('.node-text').textContent.trim()}' ì¹´í…Œê³ ë¦¬ ë©”ë‰´ê°€ ëª¨ë‘ ì œì™¸ë˜ì—ˆì–´ìš”!`;
                    buttonContainer.classList.remove('hidden');
                    return;
                }
                const next = availableChildren[Math.floor(Math.random() * availableChildren.length)];
                path.push(next);
                current = next;
            }
            
            path.forEach(ensurePathVisible);

            let idx = 0;
            const interval = setInterval(() => {
                if (idx > 0 && path[idx - 1] !== selectionStartNode) {
                    path[idx - 1].classList.remove('highlight');
                }
                if (idx < path.length) {
                    path[idx].classList.add('highlight');
                    idx++;
                } else {
                    clearInterval(interval);
                    const finalChoice = path[path.length - 1];
                    const finalText = finalChoice.querySelector('.node-text').textContent.trim();
                    finalChoice.classList.add('highlight');
                    resultDiv.innerHTML = `ğŸ‰ ì˜¤ëŠ˜ì€... <strong>${finalText}</strong>! ğŸ‰`;
                    
                    kakaoMapButton.dataset.food = finalText;
                    buttonContainer.classList.remove('hidden');
                    kakaoMapButton.classList.remove('hidden');
                }
            }, 700);
        }
        
        setupNodes();
    });
  </script>
</body>
</html>
